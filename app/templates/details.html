{% extends 'base-home.html' %}
<link rel="stylesheet" href="../static/styles/base.css" />

{% block header %}
<h1>{% block title %} {{movie.title}}{% endblock %}</h1>
{% endblock %}

{% block content %}

<div>

  <div class="row">
    <div class="col-3">
      <div class="row">
        <div class="col-12">
          <img src="{{ movie.id|get_poster(movie.title, movie.year, movie.poster) }}" alt="Poster Not Available">
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="btn-wrapper">
            <input class="btn" type="button" value="Rank" onclick="location.href = '/rank-by-movie/{{movie.id}}'" />
          </div>
          <div class="btn-wrapper">
            <input class="btn" type="button" value="{{timesRankedString}}" onclick="location.href = '/rank-by-movie-unique/{{movie.id}}'" />
          </div>
          <div class="btn-wrapper">
            <input class="btn" type="button" value="Rank By Proximity" onclick="location.href = '/rank-by-close/{{movie.id}}'" />
          </div>
         
          
          <div class="btn-wrapper">
            <input class="btn" type="button" value="Ranking Details"
              onclick="location.href = '/ranking-details/{{movie.id}}'" />
          </div>
          
          <div class="btn-wrapper">
            <input class="btn" type="button" value="Ranking Upsets"
              onclick="location.href = '/ranking-upsets/{{movie.id}}'" />
          </div>
          <div class="btn-wrapper">
            <input class="btn" type="button" value="Auto Rank (Conservative)"
              onclick="location.href = '/auto-rank/{{movie.id}}'" />
          </div>
          <div class="btn-wrapper">
            <input class="btn" type="button" value="Auto Rank (Certain)"
            onclick="confirmDelete('{{movie.id}}')" />
          </div>
        </div>
      </div>
    </div>
    <div class="col-4">
      <h4>
        <a style="color: brown;" href='http://www.google.com/search?q={{movie.title}} ({{movie.year}})' target="_blank" title="{{ movie.year }}" > <u> {{ movie.title }}  </u></a> {% if movie.liked == 1 %}
            <span style="color: red;">&#128077;</span> <!-- Red heart -->
          {% elif movie.liked == 2 %}
            <span>&#129309;</span> <!-- Handshake -->
          {% elif movie.liked == 3 %}
            <span>&#128078;</span> <!-- Trash can -->
        
            {% else %}
  <!-- Display all icons with onclick event for users to select -->
  <span id="heart-icon" style="color: red; cursor:pointer; {{ 'display: none;' if movie.liked == 1 else '' }}" onclick="updateMovieLiked({{movie.id}}, 1)">&#128077;</span> <!-- Red heart -->
  <span id="handshake-icon" style="cursor:pointer; {{ 'display: none;' if movie.liked == 2 else '' }}" onclick="updateMovieLiked({{movie.id}}, 2)">&#129309;</span> <!-- Handshake -->
  <span id="trash-icon" style="cursor:pointer; {{ 'display: none;' if movie.liked == 3 else '' }}" onclick="updateMovieLiked({{movie.id}}, 3)">&#128078;</span> <!-- Trash can -->
{% endif %}
{% if movie.onComputer %} üñ•Ô∏è {% endif %}
<script>
  function updateMovieLiked(movieId, likedValue) {
    fetch(`/update-movie-liked/${movieId}/${likedValue}`)
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Hide all icons initially
        document.getElementById('heart-icon').style.display = 'none';
        document.getElementById('handshake-icon').style.display = 'none';
        document.getElementById('trash-icon').style.display = 'none';
  
        // Show only the clicked icon
        switch (likedValue) {
          case 1:
            document.getElementById('heart-icon').style.display = 'inline';
            break;
          case 2:
            document.getElementById('handshake-icon').style.display = 'inline';
            break;
          case 3:
            document.getElementById('trash-icon').style.display = 'inline';
            break;
        }
      } else {
        alert('Failed to update.');
      }
    })
    .catch((error) => {
      console.error('Error:', error);
    });
  }
  </script>
      </h4>

      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Year: </h4>
        <h4 class="col-lg-6" style="color: grey; "> <a href='/all-movies-year/{{movie.year}}'> {{ movie.year }} </a></h4>

      </div>
      

      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Genres: </h4>
        <h4 class="col-lg-6" style="color: rgb(104, 95, 95); "> {{ movie.genres }}</h4>

      </div>

      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Director: </h4>
        <h4 class="col-lg-6" style="color:  rgb(104, 95, 95); "> <a href='/all-movies/{{movie.director}}'> {{ movie.director }} </a>
        </h4>

      </div>

      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Runtime: </h4>
        <h4 class="col-lg-6" style="color:  rgb(104, 95, 95); "> {{ movie.runtime }} minutes</h4>

      </div>

      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Current Rank: </h4>
        <h4 class="col-lg-6" style="color:  rgb(104, 95, 95); "> #{{ movie.rank }}</h4>

      </div>


      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Head to Head: </h4>
        <h4 class="col-lg-6" style="color:  rgb(104, 95, 95); "> {{ movie.rankingWinCount }} / {{ movie.rewatchCount }} ({{
          movie.rankingPercentage }}%)</h4>

      </div>

    
      {% if movie.stars is not none and movie.stars != 0 and movie.stars|string|length > 0 and movie.stars != 'None' %}

      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Stars: </h4>
        <h4 class="col-lg-6" style="{% if movie.stars is none or movie.stars is string and movie.stars.isdigit() == False %}color:white;
        {% elif movie.stars|string|int >= 8 %}color:green;
        {% elif movie.stars|string|int >= 6 %}color:orange;
        {% else %}color:red;
        {% endif %}"> {{ movie.stars }} / 10
        </h4>

      </div>
      

      {% endif %}

      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Recommended Stars: </h4>
        <h4 class="col-lg-6" > <a href="/ranking-details-by-stars/{{movie.id}}">{{ movie.movieRecommendStars }}/10</a> 

        </h4>

      </div>

      

      {% if movie.recommend is not none and movie.recommend|length > 0 and movie.recommend != 'None' %}

      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Recommendation: </h4>
        <h4 class="col-lg-6"
          style="{{ 'color:white;' if movie.recommend is none or movie.recommend == 'None' else 'color:green;' if movie.recommend == 'Would recommned' else 'color:darkorange;' if movie.recommend == 'If you have time' else 'color:red' }}">
          {{ movie.recommend }}</h4>

      </div>
      {% endif %}

      {% if movie.notes is not none and movie.notes|length > 0 and movie.notes != 'None' %}
      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Notes: </h4>
        <h4 class="col-lg-6" style="color:  rgb(104, 95, 95); "> {{ movie.notes }}</h4>

      </div>
      {% endif %}

      {% if movie.faveQuote is not none and movie.faveQuote|length > 0 and movie.faveQuote != 'None' %}
  <div class="row">
    <h4 class="col-lg-6" style="color: black; "> Favourite Quote: </h4>
    <h4 class="col-lg-6" style="color: rgb(104, 95, 95); "> {{ movie.faveQuote }}</h4>
  </div>
{% endif %}




      <div class="row" style="padding-top: 10%;">
       
        <div class="col-6">
          <div class="btn-wrapper">
            <input class="btn" type="button" value="Watch Logs ({{movie.timesWatched}} Times)"
              onclick="location.href = '/log-movie/{{movie.id}}'" />
          </div>
        </div>
        <div class="col-6">

          <div class="btn-wrapper">
            <input class="btn" type="button" value="Edit Movie"
              onclick="location.href = '/update-movie/{{movie.id}}'" />
          </div>


        </div>
        <div class="col-12">
          <div class="btn-wrapper">
            <input class="btn" type="button" value="Similar Movies" onclick="location.href = '/similar/{{movie.id}}'" />

          </div>
        </div>
      </div>

    </div>

    <div class="col-2">
      <h4 style="color: blue;">
        Watch Details:
      </h4>
      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Currently Watching? </h4>
        <h4 class="col-lg-6" style="color:  rgb(104, 95, 95); "> {{ currently }}</h4>

      </div>
      

      <div class="row">
        <h4 class="col-lg-6" style="color: black; "> Want To Rewatch? </h4>
        <h4 class="col-lg-6" style="color:  rgb(104, 95, 95); "> {{ rewatched }}</h4>

      </div>

      {% if movie.currentlyWatching != 1 %}
      <div class="btn-wrapper">
        <input class="btn" type="button" value="Watching" onclick="location.href = '/current/{{movie.id}}'" />

      </div>
      {% endif %}

      {% if movie.rewatch != 1 %}
      <div class="btn-wrapper">
        <input class="btn" type="button" value="Rewatch" onclick="location.href = '/rewatch/{{movie.id}}'" />

      </div>
      {% endif %}
      

    </div>

    <div class="col-3">
      <h4>
        Head to Head:
      </h4>
      <div>
        <div id="movies">
          <table>
            <tr>
              <th>Movie</th>
              <th>Title</th>
              <th>Genres</th>
              <th>Stars</th>
              <th>Points</th>
              <th>Rank</th>
            </tr>
            {% for movie in similar1 %}
            <tr>
              <td style="width: 16%;"> <a href='/details/{{movie.id}}' title="#{{movie.rank}}"><img
                    src="{{ movie.id|get_poster(movie.title, movie.year, movie.poster)}}" alt="Poster Not Available."> </a></td>
              <td><a style="color: brown;" style="color: brown;"
                  href='http://www.google.com/search?q={{movie.title}} ({{movie.year}})' title="{{ movie.year }}"  target="_blank"> <u> 
                    {{ movie.title }}  </u></a> {% if movie.liked == 1 %}
            <span style="color: red;">&#128077;</span> <!-- Red heart -->
          {% elif movie.liked == 2 %}
            <span>&#129309;</span> <!-- Handshake -->
          {% elif movie.liked == 3 %}
            <span>&#128078;</span> <!-- Trash can -->
        
           {% endif %} {% if movie.onComputer %} üñ•Ô∏è {% endif %}</td>
              <td>{{ movie.genres }}</td>
              <td style="{% if movie.stars is none or movie.stars is string and movie.stars.isdigit() == False %}color:white;
                    {% elif movie.stars|string|int >= 8 %}color:green;
                    {% elif movie.stars|string|int >= 6 %}color:orange;
                    {% else %}color:red;
                    {% endif %}">
                {{ movie.stars }}/10
              </td>
              <td>{{ movie.rewatchScore }}</td>
              <td>#{{ movie.rank }}</td>
            </tr>
            {% endfor %}
            {% for movie in actualMovie %}
            <tr>
              <td style="width: 16%;"> <a href='/details/{{movie.id}}' title="#{{movie.rank}}"><img
                    src="{{ movie.id|get_poster(movie.title, movie.year, movie.poster)}}" alt="Poster Not Available."> </a></td>
              <td style="background-color: beige;"><a href='http://www.google.com/search?q={{movie.title}}'
                title="{{ movie.year }}"  target="_blank"> <u> {{ movie.title }}  </u></a> {% if movie.liked == 1 %}
            <span style="color: red;">&#128077;</span> <!-- Red heart -->
          {% elif movie.liked == 2 %}
            <span>&#129309;</span> <!-- Handshake -->
          {% elif movie.liked == 3 %}
            <span>&#128078;</span> <!-- Trash can -->
        
           {% endif %} {% if movie.onComputer %} üñ•Ô∏è {% endif %}</td>
              <td style="background-color: beige;">{{ movie.genres }}</td>
              <td style=" background-color: beige; {% if movie.stars is none or movie.stars is string and movie.stars.isdigit() == False %}color:white;
          {% elif movie.stars|string|int >= 8 %}color:green;
          {% elif movie.stars|string|int >= 6 %}color:orange;
          {% else %}color:red;
          {% endif %}">
                {{ movie.stars }}/10
              </td>
              <td style="background-color: beige;">{{ movie.rewatchScore }}</td>
              <td style="background-color: beige;">#{{ movie.rank }}</td>
            </tr>
            {% endfor %}
            {% for movie in similar2 %}
            <tr>
              <td style="width: 16%;"> <a href='/details/{{movie.id}}' title="#{{movie.rank}}"><img
                    src="{{ movie.id|get_poster(movie.title, movie.year, movie.poster)}}" alt="Poster Not Available."> </a></td>
              <td><a style="color: brown;" href='http://www.google.com/search?q={{movie.title}} ({{movie.year}})'
                title="{{ movie.year }}"     target="_blank"> <u> {{ movie.title }}  </u></a> {% if movie.liked == 1 %}
            <span style="color: red;">&#128077;</span> <!-- Red heart -->
          {% elif movie.liked == 2 %}
            <span>&#129309;</span> <!-- Handshake -->
          {% elif movie.liked == 3 %}
            <span>&#128078;</span> <!-- Trash can -->
        
           {% endif %} {% if movie.onComputer %} üñ•Ô∏è {% endif %}</td>
              <td>{{ movie.genres }}</td>
              <td style="{% if movie.stars is none or movie.stars is string and movie.stars.isdigit() == False %}color:white;
                    {% elif movie.stars|string|int >= 8 %}color:green;
                    {% elif movie.stars|string|int >= 6 %}color:orange;
                    {% else %}color:red;
                    {% endif %}">
                {{ movie.stars }}/10
              </td>
              <td>{{ movie.rewatchScore }}</td>
              <td>#{{ movie.rank }}</td>
            </tr>
            {% endfor %}
          </table>
        </div>

      </div>
      {% for list in lists %}
      <div class="col-12">
        <input class="btn" style="text-align: center;" type="button" value="{{list.name}}"
          onclick="location.href = '/list/{{list.id}}'" />
      </div>
      {% endfor %}
      <input class="btn" type="button" value="View Rankings"
      onclick="location.href='/rankings/{{ movie.id }}'" />

    </div>

    <script>
      function confirmDelete(movieId) {
        // Use confirm() to show a popup
        if(confirm('Are you sure you want to auto rank?')) {
          // If the user confirms, redirect to the delete URL
          location.href = '/auto-rank-certain/' + movieId;
        }
        // If the user cancels, do nothing
      }

  
    </script>

  </div>
</div>
</form>
</div>
{% endblock %}